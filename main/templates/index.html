{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block scripts %}
{{ super() }}
<script>
    // A function to bind the staff name and staff id
    function changeIdWhenNameChanges(name, id) {
        var elemName = document.getElementById(name);
        var elemId = document.getElementById(id);
        elemName.addEventListener("change", function() {
            elemId.selectedIndex = elemName.selectedIndex;
        });
    }

    changeIdWhenNameChanges("created_by_name", "created_by_id");
    changeIdWhenNameChanges("closed_by_name", "closed_by_id");
    changeIdWhenNameChanges("assign_to_name", "assign_to_id");

    // Ensure that the disabled field is still submitted
    $("#req_form").submit(function(event) {
        $("#created_by_id").prop("disabled", false);
        $("#closed_by_id").prop("disabled", false);
        $("#assign_to_id").prop("disabled", false);
    });

    // When radio button is already selected, hide the non-relevant element
    if (document.getElementById('reason-0').checked) $(".created,.assigned").hide();
    if (document.getElementById('reason-1').checked) $(".created,.closed").hide();

    // Hide the non-relevant element
    $("#reason-0").change(function() { // For closed
        $(".created,.assigned").hide();
        $(".closed").show();
    });
    $("#reason-1").change(function() { // For assigned
        $(".created,.closed").hide();
        $(".assigned").show();
    });
    $("#reason-2").change(function() { // For others
        $(".created, .closed, .assigned").show();
    });
</script>
{% endblock %}

{% block app_content %}
    <h1>Welcome, {{ current_user.staff_name }}!</h1>
    <p>You should be able to fill up the form here!</p>

    <p>Name of Staff: {{ current_user.staff_name }}</p>
    <p>Staff ID: {{ current_user.staff_id }}</p>
    <p>Staff Designation: {{ current_user.staff_designation }}</p>
    <p>Date Appealed: {{ moment(current_time).format('LLL') }}</p>

    <h2>Details required for the application</h2>
    <form id="req_form" action="" method="post" novalidate>
        {{ form.hidden_tag() }}
        {{ wtf.form_errors(form, hiddens="only") }}

        <h3>Reason for Request</h3>
        {{ wtf.form_field(form.reason) }}

        <!-- All staff ID is automatically generated from staff name, hence is disabled -->
        <div class="created">
            <h3>Opportunity created by</h3>
            {{ wtf.form_field(form.created_by_name) }}
            {{ wtf.form_field(form.created_by_id, disabled=true) }}
            {{ wtf.form_field(form.create_date) }}
        </div>

        <div class="closed">
            <h3>Opportunity closed by</h3>
            {{ wtf.form_field(form.closed_by_name) }}
            {{ wtf.form_field(form.closed_by_id, disabled=true) }}
            {{ wtf.form_field(form.close_date) }}
        </div>

        <div class="assigned">
            <h3>Opportunity assigned to</h3>
            {{ wtf.form_field(form.assign_to_name) }}
            {{ wtf.form_field(form.assign_to_id, disabled=true) }}
        </div>

        {{ wtf.form_field(form.pdt_name) }}
        {{ wtf.form_field(form.submit) }}
    </form>
{% endblock %}
